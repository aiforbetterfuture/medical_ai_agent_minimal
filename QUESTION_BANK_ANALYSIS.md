# 멀티턴 질문 뱅크 분석 보고서

## 📋 분석 목적

다음 세 가지 기준으로 질문 뱅크를 평가:
1. **모호한 질문**: 사용자 맥락이 불명확하여 해석이 다양할 수 있는 질문
2. **일반론적 질문**: 사용자 맥락 반영 없이 LLM과 AI Agent 모드에서 동일한 일반론적 답변만 가능한 질문
3. **턴 간 연속성 부족**: 앞 턴의 질문과 완전히 동떨어진 일반론적 질문

---

## 🔴 문제가 있는 질문 목록

### Turn 2 (implicit_followup_must_use_memory)

#### ❌ **T2_Q03**: 매우 일반론적, 맥락 부족
```json
"template_text": "통증/불편감이 하루 중 다섯번 역해요. 증상 관찰을 어떻게 기록하면 좋을까요?"
```

**문제점**:
- "통증/불편감"이 구체적으로 무엇인지 불명확 (앞 턴의 {CC}와 연결 안 됨)
- "다섯번"이라는 숫자가 플레이스홀더가 아님 (고정값)
- 사용자 프로필 정보(나이, 기저질환, 약물)와 무관한 일반론적 질문
- LLM과 AI Agent 모드에서 동일한 일반론적 답변만 가능

**개선안**:
```
{CC}가 하루 중 여러 번 반복되는데, 증상 관찰을 어떻게 기록하면 좋을까요?
```

#### ❌ **T2_Q04**: 맥락 부족, 모호함
```json
"template_text": "이 증상에서 바로 병원에 가야 하는 상황과 며칠 지켜봐도 되는 상황을 구분해 주세요."
```

**문제점**:
- "이 증상"이 무엇인지 불명확 (앞 턴의 {CC}를 직접 언급하지 않음)
- 사용자 프로필(나이, 기저질환, 약물)을 반영하지 않으면 일반론적 답변만 가능
- LLM과 AI Agent 모드에서 동일한 일반론적 답변 가능

**개선안**:
```
{CC}가 있을 때, 제 나이({AGE}세)와 {COND1_KO} 상태를 고려해서 바로 병원에 가야 하는 상황과 며칠 지켜봐도 되는 상황을 구분해 주세요.
```

#### ❌ **T2_Q06**: 매우 일반론적
```json
"template_text": "비슷한 증상이 반복될 때 가장 먼저 의심해야 하는 위험 요인은 뭐가 있나요?"
```

**문제점**:
- "비슷한 증상"이 무엇인지 불명확
- 사용자 프로필 정보 전혀 반영 안 됨
- 완전히 일반론적 질문
- LLM과 AI Agent 모드에서 동일한 일반론적 답변만 가능

**개선안**:
```
{CC}가 반복될 때, {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 가장 먼저 의심해야 하는 위험 요인은 뭐가 있나요?
```

#### ❌ **T2_Q08**: 맥락 부족
```json
"template_text": "지금 증상에서 추가로 물어봐야 할 질문(의사가 확인할 문진 항목)을 체크리스트로 주세요."
```

**문제점**:
- "지금 증상"이 무엇인지 불명확
- 사용자 프로필 정보 반영 안 됨
- 일반론적 체크리스트만 제공 가능

**개선안**:
```
{CC}가 있을 때, {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 추가로 물어봐야 할 질문(의사가 확인할 문진 항목)을 체크리스트로 주세요.
```

#### ❌ **T2_Q09**: 매우 일반론적
```json
"template_text": "검사 없이도 자가로 확인 가능한 신체 징후나 간단 테스트가 있나요?"
```

**문제점**:
- 어떤 증상에 대한 것인지 전혀 언급 안 됨
- 사용자 프로필 정보 전혀 반영 안 됨
- 완전히 일반론적 질문
- LLM과 AI Agent 모드에서 동일한 일반론적 답변만 가능

**개선안**:
```
{CC}가 있을 때, 검사 없이도 자가로 확인 가능한 신체 징후나 간단 테스트가 있나요?
```

#### ❌ **T2_Q10**: 맥락 부족
```json
"template_text": "이 증상이 지속되면 보통 어떤 검사를 하게 되나요? 검사 목적도 같이 설명해 주세요."
```

**문제점**:
- "이 증상"이 무엇인지 불명확
- 사용자 프로필 정보 반영 안 됨
- 일반론적 검사 목록만 제공 가능

**개선안**:
```
{CC}가 지속되면, {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 보통 어떤 검사를 하게 되나요? 검사 목적도 같이 설명해 주세요.
```

#### ❌ **T2_Q12**: 맥락 부족
```json
"template_text": "현재 증상에서 '하면 안 되는 행동/약'이 있으면 알려주세요(가능한 범위에서)."
```

**문제점**:
- "현재 증상"이 무엇인지 불명확
- 사용자 프로필 정보 반영 안 됨
- 일반론적 금기사항만 제공 가능

**개선안**:
```
{CC}가 있을 때, {MED1_KO}을(를) 복용 중인 경우 '하면 안 되는 행동/약'이 있으면 알려주세요.
```

#### ❌ **T2_Q13**: 맥락 부족
```json
"template_text": "오늘 밤처럼 의료 접근이 어렵다면, 안전하게 버틸 수 있는 최소행동지침을 알려주세요."
```

**문제점**:
- 어떤 증상에 대한 것인지 전혀 언급 안 됨
- 사용자 프로필 정보 전혀 반영 안 됨
- 일반론적 행동지침만 제공 가능

**개선안**:
```
{CC}가 있고 오늘 밤처럼 의료 접근이 어렵다면, {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 안전하게 버틸 수 있는 최소행동지침을 알려주세요.
```

#### ❌ **T2_Q14**: 맥락 부족
```json
"template_text": "이 증상과 관련해 제가 놓치기 쉬운 위험 신호 3가지만 꼽아 주세요."
```

**문제점**:
- "이 증상"이 무엇인지 불명확
- 사용자 프로필 정보 반영 안 됨
- 일반론적 위험 신호만 제공 가능

**개선안**:
```
{CC}와 관련해, {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 놓치기 쉬운 위험 신호 3가지만 꼽아 주세요.
```

#### ❌ **T2_Q15**: 맥락 부족
```json
"template_text": "제가 말한 증상에서 바로 관찰해야 할 항목(빈도/강도/유발요인)을 표로 정리해 주세요."
```

**문제점**:
- "제가 말한 증상"이 무엇인지 불명확 (앞 턴의 {CC}를 직접 언급하지 않음)
- 사용자 프로필 정보 반영 안 됨
- 일반론적 관찰 항목만 제공 가능

**개선안**:
```
{CC}에 대해 바로 관찰해야 할 항목(빈도/강도/유발요인)을 표로 정리해 주세요.
```

---

### Turn 3 (update_new_evidence)

#### ⚠️ **T3_Q05**: 맥락 부족
```json
"template_text": "증상이 악화돼서 {NEW_INFO}가 추가됐습니다. 지금 단계에서 위험 신호 체크를 다시 해주세요."
```

**문제점**:
- 앞 턴의 {CC}와 연결이 약함
- 사용자 프로필 정보 반영 안 됨
- {NEW_INFO}만으로는 맥락이 부족할 수 있음

**개선안**:
```
{CC}가 악화돼서 {NEW_INFO}가 추가됐습니다. {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 지금 단계에서 위험 신호 체크를 다시 해주세요.
```

---

### Turn 4 (near_duplicate_plus_minor_addition)

#### ⚠️ **T4_Q06**: 일반론적
```json
"template_text": "같은 증상이라도 {OTC} 같은 요인이 있으면 위험도가 달라지나요?"
```

**문제점**:
- "같은 증상"이 무엇인지 불명확 (앞 턴의 {CC}를 직접 언급하지 않음)
- 사용자 프로필 정보 반영 안 됨

**개선안**:
```
{CC}가 있는데 {OTC}을(를) 복용한 경우 위험도가 달라지나요?
```

#### ⚠️ **T4_Q10**: 일반론적
```json
"template_text": "혹시 {OTC}이(가) 금기일 수 있는 경우가 있나요? 제 상태에서 일반 원칙을 설명해 주세요."
```

**문제점**:
- "제 상태"가 무엇인지 불명확 (사용자 프로필 정보가 플레이스홀더로 반영 안 됨)
- 일반 원칙만 설명 가능

**개선안**:
```
{AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있으며 {MED1_KO}을(를) 복용 중인 경우, {OTC}이(가) 금기일 수 있는 경우가 있나요?
```

---

### Turn 5 (personalized_plan_and_safety_net)

#### ✅ **대부분 양호**: Turn 5는 "지금까지 제가 말한 상황"을 명시적으로 언급하므로 맥락 반영이 잘 되어 있음

---

## 📊 문제 요약

### 문제 질문 통계

| Turn | 문제 질문 수 | 총 질문 수 | 문제 비율 |
|------|------------|----------|----------|
| Turn 1 | 0 | 15 | 0% |
| Turn 2 | 10 | 15 | **66.7%** ⚠️ |
| Turn 3 | 1 | 15 | 6.7% |
| Turn 4 | 2 | 15 | 13.3% |
| Turn 5 | 0 | 15 | 0% |
| **전체** | **13** | **75** | **17.3%** |

### 문제 유형별 분류

1. **맥락 부족 (Context Missing)**: 10개
   - "이 증상", "지금 증상", "제가 말한 증상" 등 모호한 지시어 사용
   - 앞 턴의 {CC}를 직접 언급하지 않음

2. **일반론적 질문 (Generic Question)**: 8개
   - 사용자 프로필 정보(나이, 성별, 기저질환, 약물) 전혀 반영 안 됨
   - LLM과 AI Agent 모드에서 동일한 일반론적 답변만 가능

3. **플레이스홀더 부족 (Missing Placeholders)**: 13개
   - {AGE}, {SEX_KO}, {COND1_KO}, {MED1_KO}, {CC} 등이 없어 개인화 불가

---

## ✅ 개선 권장사항

### 1. Turn 2 질문 대폭 개선 필요

**현재 문제**: Turn 2는 "implicit_followup_must_use_memory" 의도인데, 많은 질문이 맥락을 명시하지 않아 메모리 사용을 강제하지 못함.

**개선 방향**:
- 앞 턴의 {CC}를 직접 언급하거나
- 사용자 프로필 정보({AGE}, {SEX_KO}, {COND1_KO}, {MED1_KO})를 플레이스홀더로 포함

### 2. 플레이스홀더 추가

문제가 있는 질문들에 다음 플레이스홀더 추가:
- `{CC}`: 앞 턴의 주증상
- `{AGE}`, `{SEX_KO}`: 기본 인구통계
- `{COND1_KO}`, `{MED1_KO}`: 기저질환 및 약물 (가능한 경우)

### 3. "이 증상", "지금 증상" 등 모호한 지시어 제거

명확한 플레이스홀더로 대체:
- "이 증상" → `{CC}`
- "지금 증상" → `{CC}`
- "제가 말한 증상" → `{CC}`

---

## 🔧 구체적 개선 예시

### 예시 1: T2_Q04 개선

**이전**:
```
"이 증상에서 바로 병원에 가야 하는 상황과 며칠 지켜봐도 되는 상황을 구분해 주세요."
```

**개선 후**:
```
"{CC}가 있을 때, {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있으며 {MED1_KO}을(를) 복용 중인 경우, 바로 병원에 가야 하는 상황과 며칠 지켜봐도 되는 상황을 구분해 주세요."
```

### 예시 2: T2_Q09 개선

**이전**:
```
"검사 없이도 자가로 확인 가능한 신체 징후나 간단 테스트가 있나요?"
```

**개선 후**:
```
"{CC}가 있을 때, 검사 없이도 자가로 확인 가능한 신체 징후나 간단 테스트가 있나요?"
```

---

## 📝 결론

**주요 발견사항**:
1. ⚠️ **Turn 2 질문의 66.7%가 문제 있음** - 가장 시급한 개선 필요
2. 맥락 부족 질문이 많아 멀티턴 대화의 핵심인 "컨텍스트 유지" 테스트가 어려움
3. 일반론적 질문으로 인해 LLM과 AI Agent 모드의 차이를 측정하기 어려움

**권장 조치**:
1. ✅ Turn 2 질문 10개 개선 (우선순위 높음)
2. ✅ Turn 3, 4 질문 3개 개선
3. ✅ 모든 질문에 적절한 플레이스홀더 추가

