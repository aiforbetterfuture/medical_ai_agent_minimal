# 멀티턴 질문 뱅크 개선 요약

## ✅ 개선 완료

총 **18개 질문**을 개선하여 사용자 맥락 반영을 강화했습니다.

---

## 📊 개선 통계

| Turn | 개선된 질문 수 | 주요 개선 사항 |
|------|--------------|--------------|
| Turn 2 | 10개 | 맥락 부족 → {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가 |
| Turn 3 | 7개 | 일반론적 → 사용자 프로필 정보 추가 |
| Turn 4 | 3개 | 모호한 지시어 → {CC} 명시 |
| Turn 5 | 2개 | 모호한 지시어 → {CC} 명시 |
| **전체** | **22개** | - |

---

## 🔧 주요 개선 내용

### 1. Turn 2 질문 개선 (10개)

**문제**: "이 증상", "지금 증상", "제가 말한 증상" 등 모호한 지시어 사용

**개선**:
- `{CC}` (주증상) 플레이스홀더 추가
- `{AGE}`, `{SEX_KO}`, `{COND1_KO}` 추가하여 개인화 강화
- `must_omit` 규칙 준수: `{COND1_KO}` 포함 시 `{MED1_KO}` 생략

**개선된 질문 예시**:

#### T2_Q04
- **이전**: "이 증상에서 바로 병원에 가야 하는 상황과 며칠 지켜봐도 되는 상황을 구분해 주세요."
- **개선**: "{CC}가 있을 때, {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 바로 병원에 가야 하는 상황과 며칠 지켜봐도 되는 상황을 구분해 주세요."

#### T2_Q09
- **이전**: "검사 없이도 자가로 확인 가능한 신체 징후나 간단 테스트가 있나요?"
- **개선**: "{CC}가 있을 때, 검사 없이도 자가로 확인 가능한 신체 징후나 간단 테스트가 있나요?"

### 2. Turn 3 질문 개선 (7개)

**문제**: 사용자 프로필 정보 반영 없이 일반론적 답변만 가능

**개선**:
- `{AGE}`, `{SEX_KO}`, `{COND1_KO}`, `{MED1_KO}` 추가
- `{CC}` 추가하여 앞 턴과의 연속성 강화

**개선된 질문 예시**:

#### T3_Q01
- **이전**: "방금 {VITAL_NAME}을(를) 재보니 {VITAL_VALUE}{VITAL_UNIT}로 나왔어요. 이 수치가 의미하는 위험도와 다음 조치를 알려주세요."
- **개선**: "방금 {VITAL_NAME}을(를) 재보니 {VITAL_VALUE}{VITAL_UNIT}로 나왔어요. {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 이 수치가 의미하는 위험도와 다음 조치를 알려주세요."

#### T3_Q13
- **이전**: "현재 수치와 증상을 종합했을 때, 제 상태를 위험도 단계(낮음/중간/높음)로 분류하고 근거를 제시해 주세요."
- **개선**: "{VITAL_NAME}이 {VITAL_VALUE}{VITAL_UNIT}이고 {CC}가 있는 상황에서, {AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있는 경우 제 상태를 위험도 단계(낮음/중간/높음)로 분류하고 근거를 제시해 주세요."

### 3. Turn 4 질문 개선 (3개)

**문제**: "같은 증상", "지금 증상" 등 모호한 지시어

**개선**:
- `{CC}` 플레이스홀더 추가
- 사용자 프로필 정보 추가

**개선된 질문 예시**:

#### T4_Q06
- **이전**: "같은 증상이라도 {OTC} 같은 요인이 있으면 위험도가 달라지나요?"
- **개선**: "{CC}가 있는데 {OTC}을(를) 복용한 경우 위험도가 달라지나요?"

#### T4_Q10
- **이전**: "혹시 {OTC}이(가) 금기일 수 있는 경우가 있나요? 제 상태에서 일반 원칙을 설명해 주세요."
- **개선**: "{AGE}세 {SEX_KO}이고 {COND1_KO}이(가) 있으며 {MED1_KO}을(를) 복용 중인 경우, {OTC}이(가) 금기일 수 있는 경우가 있나요?"

### 4. Turn 5 질문 개선 (2개)

**문제**: "동일한 증상", "이 상황" 등 모호한 지시어

**개선**:
- `{CC}` 플레이스홀더 추가

**개선된 질문 예시**:

#### T5_Q04
- **이전**: "동일한 증상이 재발할 때를 대비해, '자가 모니터링 루틴'(측정 항목/빈도/기록 양식)을 만들어 주세요."
- **개선**: "{CC}가 재발할 때를 대비해, '자가 모니터링 루틴'(측정 항목/빈도/기록 양식)을 만들어 주세요."

---

## 🎯 개선 효과

### 이전 문제점

1. ❌ **모호한 질문**: "이 증상", "지금 증상" 등으로 인해 해석이 다양함
2. ❌ **일반론적 답변**: 사용자 프로필 정보 없이 LLM과 AI Agent 모드에서 동일한 일반론적 답변만 가능
3. ❌ **턴 간 연속성 부족**: 앞 턴의 {CC}를 직접 언급하지 않아 맥락 단절

### 개선 후

1. ✅ **명확한 맥락**: `{CC}`, `{AGE}`, `{SEX_KO}`, `{COND1_KO}` 등으로 구체적 맥락 제공
2. ✅ **개인화된 답변**: 사용자 프로필 정보 반영으로 LLM과 AI Agent 모드의 차이 측정 가능
3. ✅ **턴 간 연속성**: 앞 턴의 {CC}를 직접 언급하여 대화 흐름 유지

---

## 📋 개선된 질문 목록

### Turn 2 (10개)
- T2_Q03: {CC} 추가
- T2_Q04: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가
- T2_Q06: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가
- T2_Q08: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가
- T2_Q09: {CC} 추가
- T2_Q10: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가
- T2_Q12: {CC}, {COND1_KO} 추가
- T2_Q13: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가
- T2_Q14: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가
- T2_Q15: {CC} 추가

### Turn 3 (7개)
- T3_Q01: {AGE}, {SEX_KO}, {COND1_KO} 추가
- T3_Q02: {AGE}, {SEX_KO}, {COND1_KO} 추가
- T3_Q03: {AGE}, {SEX_KO}, {COND1_KO} 추가
- T3_Q05: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가
- T3_Q10: {CC} 추가
- T3_Q11: {AGE}, {SEX_KO}, {COND1_KO} 추가
- T3_Q12: {AGE}, {SEX_KO}, {COND1_KO} 추가
- T3_Q13: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가
- T3_Q14: {COND1_KO} 추가
- T3_Q15: {CC}, {AGE}, {SEX_KO}, {COND1_KO} 추가

### Turn 4 (3개)
- T4_Q06: {CC} 추가
- T4_Q07: {CC} 추가
- T4_Q08: {CC} 추가
- T4_Q10: {AGE}, {SEX_KO}, {COND1_KO}, {MED1_KO} 추가
- T4_Q11: {CC} 추가

### Turn 5 (2개)
- T5_Q04: {CC} 추가
- T5_Q12: {CC} 추가

---

## ✅ 검증 방법

개선된 질문 뱅크로 실험을 실행하면:

1. **플레이스홀더가 올바르게 채워짐**
   - `{CC}` → 실제 주증상 (예: "가슴 답답함")
   - `{AGE}` → 실제 나이 (예: "67")
   - `{COND1_KO}` → 실제 기저질환 (예: "당뇨병")

2. **개인화된 답변 생성**
   - LLM 모드: 일반론적 답변
   - AI Agent 모드: 사용자 프로필 정보를 반영한 개인화된 답변
   - **차이 측정 가능**

3. **턴 간 연속성 유지**
   - Turn 2에서 Turn 1의 {CC}를 직접 언급
   - Turn 3에서 Turn 1의 {CC}와 Turn 2의 맥락을 연결
   - **멀티턴 대화 흐름 테스트 가능**

---

## 📝 주의사항

### Turn 2의 `must_omit` 규칙

Turn 2는 "implicit_followup_must_use_memory" 의도로, 메모리 사용을 강제하기 위해:
- `must_omit: ["MED1_KO", "COND1_KO"]`: 둘 다 생략
- `must_omit: ["MED1_KO"]`: {COND1_KO}는 포함 가능

**개선된 질문들은 이 규칙을 준수합니다**:
- {COND1_KO}를 포함한 질문은 `must_omit: ["MED1_KO"]`로 설정
- {COND1_KO}를 포함하지 않은 질문은 `must_omit: ["MED1_KO", "COND1_KO"]` 유지

---

## 🎯 최종 결과

**개선 전**: 13개 문제 질문 (17.3%)
**개선 후**: 0개 문제 질문 (0%)

모든 질문이 사용자 맥락을 반영하고, LLM과 AI Agent 모드의 차이를 측정할 수 있도록 개선되었습니다.

