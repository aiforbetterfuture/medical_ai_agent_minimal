## 첫 턴 컨텍스트 강화 기능별 시간/토큰 비용과 트레이드오프

### 전제
- 현재 스캐폴드에서 LLM 호출 자체가 약 1분 이상 소요된다는 피드백이 있음. 아래는 7개 개선안이 추가로 주는 부담과 완화책을 정리한 것.
- 수치는 정량 계측 전의 보수적 추정이며, 실제 측정 후 조정 필요.

### 1) 프로필/장기 컨텍스트 선적재
- 시간: 프로필/요약을 로컬 스토어에서 읽어오는 수준이면 <100 ms, 원격 저장소라면 RTT 만큼 증가.
- 토큰: 프로필 텍스트가 길면 프롬프트 토큰이 +100~400 정도 증가 가능. 장기 요약 포함 시 추가 +100~300.
- 트레이드오프: 개인화가 즉시 드러나 품질 향상. 토큰 증가로 LLM 비용·응답시간 소폭 상승. 프로필을 3~5줄로 압축하면 비용/시간 부담 제한.

### 2) 첫 턴 검색 강제 + 근거 포함
- 시간: 검색/벡터 조회 0.3~1.5 s 추정(로컬 임베딩/인덱스 기준). 네트워크/외부 API 사용 시 더 커질 수 있음.
- 토큰: 상위 3~5개 문서 스니펫을 200~600토큰으로 제한하면 총 프롬프트 +200~600.
- 트레이드오프: 근거 기반 답변으로 차별화되나, 시간이 가장 크게 늘어나는 요소. 상위 3개, 각 1~2문장으로 제한하고 캐시/프리패칭 고려.

### 3) 시스템/유저 프롬프트 개인화 지침 강화
- 시간: 프롬프트 생성 계산은 무시 가능한 수준.
- 토큰: 시스템 프롬프트가 수십~100토큰 정도 증가.
- 트레이드오프: 품질↑, 비용/시간 영향 경미. 유지 추천.

### 4) 슬롯 우선 흐름 및 결핍 시 보강
- 시간: 슬롯 추출(LLM/규칙)에 따라 다름. 규칙/경량 모델이면 <200 ms, LLM 한 번 더 부르면 수 초 추가.
- 토큰: 슬롯 결과는 짧아 영향 미미. 추가 LLM 호출이 있다면 비용/시간이 가장 크므로 규칙/라이트 모델 우선 권장.
- 트레이드오프: 정보가 없을 때도 개인화를 확보하거나 짧은 확인 질문을 유도. 가능하면 비-LLM 경량 추출로 구현해 시간 증가 최소화.

### 5) 컨텍스트 매니저 토큰 플랜 보정
- 시간: 계산/조립은 <50 ms 수준.
- 토큰: 프로필/장기 영역을 최소 예산으로 고정해 약간의 추가 토큰만 유지.
- 트레이드오프: 첫 턴에 프로필이 잘리지 않음. 시간/비용 영향 거의 없음. 유지 강력 추천.

### 6) 첫 턴 플래그 기본값 정비(프로필/장기/evidence on)
- 시간/토큰: 자체 비용 없음. 다만 1)과 2)에서 언급한 부하를 기본으로 항상 적용하게 됨.
- 트레이드오프: 품질 기본값을 높이는 대신 항상 추가 토큰/시간이 소요. A/B 스위치로 환경변수/feature flag 제공 권장.

### 7) 검증 및 모니터링 스크립트
- 시간: 오프라인 비교 실행 시만 추가. 런타임 영향 없음.
- 토큰: 없음(테스트 시에만 비용).
- 트레이드오프: 품질 향상을 계측 가능. 운영 응답 시간에는 영향 없음.

## 종합 권장안 (속도 vs 품질 관점)
- 최우선 유지(품질↑, 비용/시간 영향 미미): 3) 프롬프트 지침 강화, 5) 토큰 플랜 보정, 7) 검증 스크립트.
- 품질 대비 비용 효율 좋음: 1) 프로필 선적재(요약을 3~5줄로 압축), 6) 기본 플래그 on (단, A/B 토글 추가).
- 신중 적용(시간 영향 큼): 2) 첫 턴 검색 강제 → 캐시/최대 3개 스니펫, 1~2문장 제한. 4) 슬롯 우선 → 규칙/경량 추출 우선, LLM 추가 호출은 피크 시간에 비활성 옵션 제공.

## 사용자 경험 추론
- 현재 1분 이상 응답이면 체감 대기 스트레스가 크므로, “빠르지만 덜 정교” 쪽을 기본으로 두고, 품질 모드(검색 강제+LLM 슬롯 추출)를 토글로 제공하는 하이브리드가 현실적.
- 제안 흐름:
  - 기본: 프로필 선적재(요약 짧게) + 프롬프트 지침 + 토큰 플랜 보정 → 시간 증가 최소화하면서 개인화/안전성 확보.
  - 고품질 모드(옵션): 첫 턴 검색 강제 + LLM 슬롯 추출을 켜서 근거/정밀도를 높이되, 스니펫 길이와 개수를 강하게 제한하여 추가 지연을 1~2 s 이내로 억제.

