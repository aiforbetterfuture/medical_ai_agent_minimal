@echo off
setlocal
REM ============================================================================
REM 12. 메모리 소모량 계산
REM - 80명 x 5턴 x 2모드 시나리오에서 메모리/토큰/캐시 소모량 계산
REM - 작업 메모리 원본 저장 시 소모량 추정
REM ============================================================================

chcp 65001 >nul
cd /d %~dp0
set PYTHONPATH=%CD%

echo ============================================================================
echo [12] 메모리 소모량 계산
echo ============================================================================
echo.
echo 이 스크립트는 다음을 계산합니다:
echo   - 작업 메모리 (Tier 1) 소모량
echo   - 압축 메모리 (Tier 2) 소모량
echo   - 의미 메모리 (Tier 3) 소모량
echo   - 토큰 소모량 (압축 시 LLM 호출)
echo   - 캐시 소모량
echo   - 비용 추정 (OpenAI GPT-4o-mini 기준)
echo.
echo 시나리오: 80명 x 5턴 (AI Agent 모드만)
echo.
pause

REM 메모리 소모량 계산 실행
echo.
echo [실행] 메모리 소모량 계산 시작...
echo ============================================================================
echo.

.venv\Scripts\python.exe experiments\calculate_memory_consumption.py

if errorlevel 1 (
    echo.
    echo ============================================================================
    echo [실패] 메모리 소모량 계산 실패
    echo ============================================================================
    echo.
    pause
    exit /b 1
)

REM 결과 확인
echo.
echo ============================================================================
echo [성공] 메모리 소모량 계산 완료!
echo ============================================================================
echo.

if exist runs\memory_consumption_report.json (
    echo [결과 파일 확인]
    echo ----------------------------------------------------------------------------
    echo 결과 파일: runs\memory_consumption_report.json
    echo.
    echo 상세 결과를 확인하세요.
)

echo.
pause

